/**  bentodev_tests.bento
 *
 *   Tests for Bento web site.
 *
 **/

site pent [=

    test_runner[] test_runners = [ pent_model_tests ]
    

    page(*) tests(params{}) [=
        boolean needs_login = false
        boolean needs_admin = false    
        boolean show_menu = false

        label = "Tests"
    
        [| <h2>Test Results</h2> |]

        /--- run all the tests in the test runner list ---/
        for test_runner tr in test_runners [=                
        
            [| <strong>[= tr.name; =]<strong><ol> |]
            
            tr.run;
        
            for test_result rslt in tr.results [=
                [| <li>Name: [= rslt.name; =]<br>
                      Passed: [= rslt.result; =]<br>
                      log:<ul>
                |]
                for msg in rslt.messages [|
                    <li>[= msg; =]</li>
                |]
                [| </ul></li> |]                
            =]
            [| </ol> |]
        =]
    =]

    test_runner pent_model_tests [=
    
        test_base test_pieces [=
            expected = "A"
            
            int num_problems(int n) = n
            
            for piece p in pieces [=
                if (p.protos.count != p.rotations * p.chirality) [=
                    eval(num_problems(: num_problems + 1 :));
                =]
            =]
            
            if (!num_problems) [=
                test_log("all pieces have correct number of protos");
                "A";
            =] else [=
                if (num_problems == 1) [=
                    test_log("one piece has incorrect number of protos");
                =] else [=
                    test_log(num_problems + " pieces have incorrect number of protos");
                =]
                eval(num_promblems(: 0 :));
            =]
                
            
        =]
    =]
=]
